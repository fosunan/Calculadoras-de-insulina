<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora Dosis de Insulina - Hospital Universitario La Merced</title>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new
Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','G-EM6WGH2SJJ');</script>
<style>
    /* Reset básico para asegurar box-sizing */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 1rem auto;
      padding: 0 1rem;
      background-image: url('Imagen de fondo presentación.png'); /* IMAGEN DE FONDO */
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-color: #f9f9f9;
      color: #333;
      font-size: 1em;
    }
    h1, h2 {
      color: #008000;
      font-size: 1.8em;
      margin-top: 1.5rem;
      margin-bottom: 0.8rem;
    }
    h1 {
      text-align: center;
      font-size: 2.2em;
    /* This is the size for "Hospital Universitario La Merced" */
    }
    .hospital-info {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .hospital-info h2 {
        font-size: 1.5em;
        margin-bottom: 0.2em;
        color: #008000;
    }
    .hospital-info p {
        font-size: 0.9em;
        color: #555;
        margin-top: 0;
    }
    .main-title {
        text-align: center;
        /* Apply same font size and color as h1 for "Hospital Universitario La Merced" */
        font-size: 2.2em;
        color: #008000;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem; /* Adjusted for new line */
    }
    .subtitle-profesionales {
        text-align: center;
        font-size: 1.2em;
        color: #000;
        font-weight: bold;
        margin-bottom: 1.5rem;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1em;
    }
    input[type=number], select {
      width: 100%;
      max-width: 200px;
      /* Incrementado para mejor pulsación en móvil */
      padding: 0.5em;
      margin-top: 0.2em;
      margin-bottom: 0.6em;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1em;
    }
    .checkbox-inline {
      display: inline-block;
      margin-right: 1.5em;
      font-size: 1em;
    }
    .checkbox-inline input {
      margin-right: 0.5em;
      vertical-align: middle;
    }
    #datosAyerContainer, #correccionRatioContainerAvanzado {
      background: #e6ffe6;
      border: 1px solid #99e699;
      padding: 1em;
      margin-top: 0.8em;
      border-radius: 6px;
    }
    button {
      margin-top: 1.2em;
      padding: 0.7em 1.2em;
      background-color: #008000;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 1.1em;
      cursor: pointer;
      width: auto;
      display: block;
    }
    button:hover {
      background-color: #005500;
    }
    .resultado {
      margin-top: 1.5em;
      font-size: 1.3em;
      font-weight: bold;
      color: #004d00;
    }
    .resultado-aviso {
        font-size: 0.9em;
        color: #cc0000;
        margin-top: 0.5em;
        font-weight: normal;
    }
    .resultado-aviso.alerta-correccion {
        color: orange;
    }
    pre.pasos {
      background: #e6ffe6;
      border: 1px solid #99e699;
      padding: 1em;
      white-space: pre-wrap;
      margin-top: 1em;
      border-radius: 6px;
      font-size: 0.9em;
      line-height: 1.4;
    }
    .pasos-correccion-ratio, .pasos-calculo-ratio-basico {
        background: #e6ffe6;
        border: 1px solid #99e699;
        padding: 1em;
        white-space: pre-wrap;
        margin-top: 1em;
        border-radius: 6px;
        font-size: 0.85em;
        line-height: 1.4;
    }
    .error-message {
      color: red;
      font-size: 0.85em;
      margin-top: -0.4em;
      margin-bottom: 0.4em;
      display: none;
    }
    .logo-container {
        text-align: center;
        margin-bottom: 1.5rem;
    }
    .logo-container img {
        max-width: 400px;
        height: auto;
        display: block;
        margin: 0 auto;
    }
    .disclaimer-text p {
        margin-bottom: 0.5em;
    }
    .aviso-extra {
        font-size: 0.95em;
        color: #555;
        margin-top: 1em;
        line-height: 1.4;
    }
    .mensaje-rojo {
        color: red;
        font-weight: bold;
        margin-top: 0.8em;
    }
    /* Estilo para el mensaje de corrección alta en rojo y negrita */
    #correccionAltaAviso {
        color: red;
        font-weight: bold;
    }
    .input-error {
        border-color: red !important;
    }

    /* Media Queries para pantallas pequeñas (smartphones) */
    @media (max-width: 600px) {
      body {
        font-size: 1.1em;
        padding: 0 0.8rem;
      }
      h1 {
        font-size: 1.8em;
      }
      h2 {
        font-size: 1.4em;
      }
      label, input[type=number], select {
        font-size: 1.1em;
      }
      input[type=number], select {
        max-width: 100%;
        padding: 0.6em;
      }
      button {
        font-size: 1.1em;
        width: 100%;
        padding: 0.8em 1em;
      }
      .resultado {
        font-size: 1.2em;
      }
      pre.pasos, .pasos-correccion-ratio, .pasos-calculo-ratio-basico {
        font-size: 0.95em;
      }
      .checkbox-inline {
        display: block;
        margin-right: 0;
        margin-bottom: 0.5em;
      }
      .logo-container img {
        max-width: 150px;
      }
  </style>
</head>
<body>
<noscript><iframe
src="https://www.googletagmanager.com/ns.html?id=G-EM6WGH2SJJ"
height="0"
width="0"
style="display:none;visibility:hidden"></iframe></noscript>
<div class="logo-container">
    <img src="COLOR_3_TINTAS.jpg" alt="Logo Área de Gestión Sanitaria de Osuna" />
  </div>

  <div class="hospital-info">
    <h1>Hospital Universitario La Merced</h1>
    <h2>Consulta de Diabetes</h2>
    <p>Francisco José Osuna Navarro</p>
    <br/> <p class="main-title">CALCULADORA BÁSICA DE PAUTA DE INSULINA RÁPIDA</p>
    <p class="subtitle-profesionales">SOLO PARA PROFESIONALES SANITARIOS</p>
  </div>

  <div class="disclaimer-text">
    <p>El funcionamiento de la calculadora se basa en el principio de que las glucemias pre y postprandiales deben ser lo más similares posible. Esta estabilidad sugiere que la cantidad de carbohidratos ingeridos guarda un equilibrio adecuado con la dosis de insulina rápida administrada para esa comida.</p>
    <p>Es importante tener en cuenta que esta calculadora no realiza ajustes ni correcciones relacionadas con factores individuales como la actividad física, el estrés, o la composición específica de los alimentos.</p>
    <p>El resultado obtenido representa una Pauta de Referencia, que puede introducirse posteriormente en la Calculadora Básica para determinar la dosis final de insulina rápida a administrar antes de la comida.</p>
  </div>

  <hr>

  <p><strong>Edición en pruebas. Versión 1a.</strong></p>

  <h2>1. Cantidad total de insulina diaria</h2>

  <label for="rapida">Unidades totales de insulina rápida diaria (de media en los últimos 2 días):</label>
  <input id="rapida" type="number" min="0" step="0.1" />
  <span class="error-message" id="errorRapida">Introduce un valor válido y no negativo.</span>

  <label for="lenta">Unidades totales de insulina lenta diaria (de media en los últimos 2 días):</label>
  <input id="lenta" type="number" min="0" step="0.1" />
  <span class="error-message" id="errorLenta">Introduce un valor válido y no negativo.</span>

  <label for="constanteCorreccion">Constante de corrección: Por defecto 1800. (Puede modificarse en personas muy sensibles a correcciones o frágiles).</label>
  <input id="constanteCorreccion" type="number" min="1" step="1" value="1800" />
  <span class="error-message" id="errorConstanteCorreccion">Introduce un valor válido y mayor que cero.</span>

  <h2>2. ¿Qué glucemias ha tenido de media estos últimos días, antes y 3 horas después de esta comida?</h2>

  <label for="glucemiaActual">Glucemia ANTERIOR a esta comida (mg/dL):</label>
  <input id="glucemiaActual" type="number" min="0" step="1" />
  <span class="error-message" id="errorGlucemiaActual">Introduce un valor válido y no negativo.</span>

  <label for="flechaGlucemia">Si tiene Monitorización, indica cómo estaba la flecha de la glucemia antes de esta comida:</label>
  <select id="flechaGlucemia">
    <option value="estable">Estable</option>
    <option value="ascenso_lento">Ascenso lento</option>
    <option value="ascenso_rapido">Ascenso rápido</option>
    <option value="descenso_lento">Descenso lento</option>
    <option value="descenso_rapido">Descenso rápido</option>
  </select>

  <label for="glucemiaPosterior">Glucemia POSTERIOR a esta comida (mg/dL):</label>
  <input id="glucemiaPosterior" type="number" min="0" step="1" />
  <span class="error-message" id="errorGlucemiaPosterior">Introduce un valor válido y no negativo.</span>

  <label for="flechaGlucemiaPosterior">Si tiene Monitorización, indica cómo estaba la flecha de la glucemia después de esta comida:</label>
  <select id="flechaGlucemiaPosterior">
    <option value="estable">Estable</option>
    <option value="ascenso_lento">Ascenso lento</option>
    <option value="ascenso_rapido">Ascenso rápido</option>
    <option value="descenso_lento">Descenso lento</option>
    <option value="descenso_rapido">Descenso rápido</option>
  </select>

  <hr>

  <h2>3. Pauta habitual de insulina de esta comida</h2>

  <label for="dosisHabitualComidaActual">Pauta de insulina rápida (Unidades):</label>
  <input id="dosisHabitualComidaActual" type="number" min="0" step="0.1" />
  <span class="error-message" id="errorDosisHabitualComidaActual">Introduce un valor válido y no negativo.</span>

  <hr>

  <h2>4. Cálculo</h2>
  <button onclick="calcularInsulina()">Calcular pauta de insulina</button>

  <div class="resultado" id="resultadoReal">Pauta de insulina real: <span id="valorPautaReal"></span></div>
  <div class="resultado" id="resultadoRecomendada">Pauta de insulina recomendada: <span id="valorPautaRecomendada"></span></div>

  <p class="resultado-aviso" id="dosisAltaAviso" style="display:none;">⚠️ Esta es una pauta alta. Por favor, revise los datos introducidos y/o consulte con su profesional sanitario.</p>
  <p class="resultado-aviso" id="correccionAltaAviso" style="display:none;">⚠️ Pauta de corrección alta ¿Está seguro?</p>
  <p class="aviso-extra">⚠️ ATENCIÓN: Esta PAUTA no representa la DOSIS final de insulina rápida que necesita para esta comida. La pauta es solo una parte del cálculo, al que deben añadirse otros ajustes importantes, como el valor objetivo de glucemia, compensaciones según el tipo de comida, o correcciones por hiperglucemia o hipoglucemia, entre otros factores.</p>
  <pre class="pasos" id="pasos"></pre>

  <script>
    // Función genérica para validar input y mostrar mensaje de error
    function validateInput(inputId, errorId, condition) {
      const input = document.getElementById(inputId);
      const errorSpan = document.getElementById(errorId);
      if (!condition(input.value) || isNaN(parseFloat(input.value))) {
        input.classList.add('input-error');
        errorSpan.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorSpan.style.display = 'none';
        return true;
      }
    }

    // Funciones de validación específicas
    const isPositiveNumber = (value) => parseFloat(value) > 0;
    const isNonNegativeNumber = (value) => parseFloat(value) >= 0;

    // Redondeo a la media unidad más cercana
    function roundToHalf(num) {
        return Math.round(num * 2) / 2;
    }

    // Función principal para calcular la dosis de insulina
    function calcularInsulina() {
      const rapida = parseFloat(document.getElementById('rapida').value);
      const lenta = parseFloat(document.getElementById('lenta').value);
      const constanteCorreccion = parseFloat(document.getElementById('constanteCorreccion').value);
      let glucemiaActual = parseFloat(document.getElementById('glucemiaActual').value);
      const flechaGlucemia = document.getElementById('flechaGlucemia').value;
      const glucemiaPosterior = parseFloat(document.getElementById('glucemiaPosterior').value);
      const flechaGlucemiaPosterior = document.getElementById('flechaGlucemiaPosterior').value;
      const dosisHabitualComidaActual = parseFloat(document.getElementById('dosisHabitualComidaActual').value);


      // Resetear mensajes de aviso
      document.getElementById('dosisAltaAviso').style.display = 'none';
      document.getElementById('correccionAltaAviso').style.display = 'none';
      document.getElementById('valorPautaReal').textContent = '';
      document.getElementById('valorPautaRecomendada').textContent = '';
      document.getElementById('pasos').textContent = '';
      // Validaciones iniciales para todos los campos principales
      let valid = true;
      valid = validateInput('rapida', 'errorRapida', isNonNegativeNumber) && valid;
      valid = validateInput('lenta', 'errorLenta', isNonNegativeNumber) && valid;
      valid = validateInput('constanteCorreccion', 'errorConstanteCorreccion', isPositiveNumber) && valid;
      valid = validateInput('glucemiaActual', 'errorGlucemiaActual', isNonNegativeNumber) && valid;
      valid = validateInput('glucemiaPosterior', 'errorGlucemiaPosterior', isNonNegativeNumber) && valid;
      valid = validateInput('dosisHabitualComidaActual', 'errorDosisHabitualComidaActual', isNonNegativeNumber) && valid;
      if (!valid) {
        document.getElementById('valorPautaReal').textContent = 'Error: Por favor, corrige los errores marcados.';
        return;
      }

      const totalInsulinaDiaria = rapida + lenta;
      let fsi = 0;
      if (totalInsulinaDiaria > 0) {
        fsi = constanteCorreccion / totalInsulinaDiaria;
      } else {
        document.getElementById('valorPautaReal').textContent = 'Error: La suma de insulina rápida y lenta no puede ser cero para calcular el FSI.';
        return;
      }
      
      let pasosTexto = `Pasos del cálculo:\n\n`;
      // Adjustment of glucemiaActual based on flechaGlucemia
      const originalGlucemiaActual = glucemiaActual;
      let ajusteGlucemiaFlecha = 0;
      pasosTexto += `1. Ajuste de Glucemia anterior según la flecha del Monitorización:\n`;
      pasosTexto += `   Glucemia anterior inicial: ${originalGlucemiaActual} mg/dL\n`;
      switch (flechaGlucemia) {
        case 'ascenso_lento':
          ajusteGlucemiaFlecha = 25;
          pasosTexto += `   Flecha (Ascenso lento): Glucemia anterior + 25 mg/dL\n`;
          break;
        case 'ascenso_rapido':
          ajusteGlucemiaFlecha = 50;
          pasosTexto += `   Flecha (Ascenso rápido): Glucemia anterior + 50 mg/dL\n`;
          break;
        case 'descenso_lento':
          ajusteGlucemiaFlecha = -25;
          pasosTexto += `   Flecha (Descenso lento): Glucemia anterior - 25 mg/dL\n`;
          break;
        case 'descenso_rapido':
          ajusteGlucemiaFlecha = -50;
          pasosTexto += `   Flecha (Descenso rápido): Glucemia anterior - 50 mg/dL\n`;
          break;
        case 'estable':
        default:
          ajusteGlucemiaFlecha = 0;
          pasosTexto += `   Flecha (Estable): Glucemia anterior + 0 mg/dL\n`;
          break;
      }
      glucemiaActual += ajusteGlucemiaFlecha;
      pasosTexto += `   Glucemia anterior ajustada: ${glucemiaActual.toFixed(1)} mg/dL\n\n`;
      // Adjustment of glucemiaPosterior based on flechaGlucemiaPosterior
      const originalGlucemiaPosterior = glucemiaPosterior;
      let ajusteGlucemiaFlechaPosterior = 0;
      pasosTexto += `   Ajuste de Glucemia posterior según la flecha del Monitorización:\n`;
      pasosTexto += `   Glucemia posterior inicial: ${originalGlucemiaPosterior} mg/dL\n`;
      switch (flechaGlucemiaPosterior) {
        case 'ascenso_lento':
          ajusteGlucemiaFlechaPosterior = 25;
          pasosTexto += `   Flecha (Ascenso lento): Glucemia posterior + 25 mg/dL\n`;
          break;
        case 'ascenso_rapido':
          ajusteGlucemiaFlechaPosterior = 50;
          pasosTexto += `   Flecha (Ascenso rápido): Glucemia posterior + 50 mg/dL\n`;
          break;
        case 'descenso_lento':
          ajusteGlucemiaFlechaPosterior = -25;
          pasosTexto += `   Flecha (Descenso lento): Glucemia posterior - 25 mg/dL\n`;
          break;
        case 'descenso_rapido':
          ajusteGlucemiaFlechaPosterior = -50;
          pasosTexto += `   Flecha (Descenso rápido): Glucemia posterior - 50 mg/dL\n`;
          break;
        case 'estable':
        default:
          ajusteGlucemiaFlechaPosterior = 0;
          pasosTexto += `   Flecha (Estable): Glucemia posterior + 0 mg/dL\n`;
          break;
      }
      const glucemiaPosteriorAjustada = glucemiaPosterior + ajusteGlucemiaFlechaPosterior;
      pasosTexto += `   Glucemia posterior ajustada: ${glucemiaPosteriorAjustada.toFixed(1)} mg/dL\n\n`;
      // 2. Cálculo de la Pauta de Corrección (PC)
      let pautaCorreccion = 0;
      let diferenciaGlucemia = glucemiaPosteriorAjustada - glucemiaActual;
      pasosTexto += `2. Cálculo de la Pauta de Corrección:\n`;
      pasosTexto += `   Glucemia anterior ajustada: ${glucemiaActual.toFixed(1)} mg/dL\n`;
      pasosTexto += `   Glucemia posterior ajustada: ${glucemiaPosteriorAjustada.toFixed(1)} mg/dL\n`;
      pasosTexto += `   Diferencia de Glucemia = Glucemia posterior ajustada - Glucemia anterior ajustada = ${glucemiaPosteriorAjustada.toFixed(1)} - ${glucemiaActual.toFixed(1)} = ${diferenciaGlucemia.toFixed(1)} mg/dL\n`;
      pasosTexto += `   Factor de Sensibilidad a la Insulina (FSI) = Constante de Corrección / (Insulina Rápida + Lenta) = ${constanteCorreccion} / (${rapida} + ${lenta}) = ${fsi.toFixed(2)}\n`;
      if (diferenciaGlucemia !== 0) {
        pautaCorreccion = roundToHalf(diferenciaGlucemia / fsi);
        pasosTexto += `   Pauta de Corrección = Diferencia de Glucemia / FSI = ${diferenciaGlucemia.toFixed(1)} / ${fsi.toFixed(2)} = ${pautaCorreccion.toFixed(1)} U\n\n`;
        if (Math.abs(pautaCorreccion) > 4 && diferenciaGlucemia >= 0) {
            document.getElementById('correccionAltaAviso').style.display = 'block';
        }
      } else {
        pautaCorreccion = 0;
        pasosTexto += `   Las glucemias ajustadas son iguales. No se requiere pauta de corrección (Pauta de Corrección = 0 U).\n\n`;
      }


      // 3. Pauta habitual de insulina para la comida
      let pautaHabitual = dosisHabitualComidaActual;
      pasosTexto += `3. Pauta habitual de insulina para esta comida:\n`;
      pasosTexto += `   Pauta Habitual = ${pautaHabitual.toFixed(1)} U\n\n`;
      // 4. Pauta Total de Insulina
      let pautaTotalReal = pautaCorreccion + pautaHabitual;
      pautaTotalReal = roundToHalf(pautaTotalReal);
      if (pautaTotalReal < 0) pautaTotalReal = 0;

      pasosTexto += `4. Pauta Total de Insulina (Real):\n`;
      pasosTexto += `   Pauta Total (Real) = Pauta de Corrección + Pauta Habitual\n`;
      pasosTexto += `   Pauta Total (Real) = ${pautaCorreccion.toFixed(1)} U (Pauta de Corrección) + ${pautaHabitual.toFixed(1)} U (Pauta Habitual) = ${pautaTotalReal.toFixed(1)} U\n\n`;
      // Calculate Pauta Recomendada (average of Pauta Habitual and Pauta Total Real)
      const pautaRecomendada = roundToHalf((pautaHabitual + pautaTotalReal) / 2);
      pasosTexto += `5. Pauta de insulina recomendada:\n`;
      pasosTexto += `   Pauta Recomendada = (Pauta Habitual + Pauta Total Real) / 2 = (${pautaHabitual.toFixed(1)} + ${pautaTotalReal.toFixed(1)}) / 2 = ${pautaRecomendada.toFixed(1)} U\n\n`;
      // Mostrar resultado y pasos
      document.getElementById('valorPautaReal').textContent = `${pautaTotalReal.toFixed(1)} Unidades`;
      document.getElementById('valorPautaRecomendada').textContent = `${pautaRecomendada.toFixed(1)} Unidades`;
      document.getElementById('pasos').textContent = pasosTexto;
      document.getElementById('pasos').style.display = 'block';

      // New condition for "pauta alta" warning
      const threshold150pc = 1.5 * dosisHabitualComidaActual;
      const threshold50pcTotalInsulina = 0.5 * (rapida + lenta);

      if (pautaTotalReal > threshold150pc || pautaTotalReal > threshold50pcTotalInsulina) {
        document.getElementById('dosisAltaAviso').style.display = 'block';
      }
    }

    // Inicializar el estado de los contenedores al cargar la página
    document.addEventListener('DOMContentLoaded', (event) => {
        // Ajustar step para dosis habitual (1 decimal)
        document.getElementById('dosisHabitualComidaActual').step = "0.1";
    });
  </script>
</body>
</html>